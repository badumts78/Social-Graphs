issue
Unpickling error: 'PlanarEmbedding' object has no attribute '__forbidden'#TITLE_END# ### Current Behavior  unpickling a `PlanarEmbedding()` fails.  ### Expected Behavior  ```python graphs_equal(pickle.loads(pickle.dumps(embedding)), embedding) # True ```  ### Steps to Reproduce  ```python import networkx as nx from networkx.utils.misc import graphs_equal import pickle  embedding = nx.PlanarEmbedding() embedding.set_data(     {         1: [2, 5, 7],         2: [1, 3, 4, 5],         3: [2, 4],         4: [3, 6, 5, 2],         5: [7, 1, 2, 4],         6: [4, 7],         7: [6, 1, 5],     } ) graphs_equal(pickle.loads(pickle.dumps(embedding)), embedding) ```  ``` --------------------------------------------------------------------------- AttributeError                            Traceback (most recent call last) Cell In[6], line 1 ----> 1 graphs_equal(pickle.loads(pickle.dumps(embedding)), embedding)  AttributeError: 'PlanarEmbedding' object has no attribute '__forbidden' ```  ### Environment  Python version: 3.12 NetworkX version: 3.5  ### Additional context  I will make a PR with the fix in a few minutes. 
issue
fix: resolve failure to pickle.loads(pickle.dumps(PlanarEmbedding()))#TITLE_END#Fixes #8185  Trying to `pickle.loads(pickle.dumps(PlanarEmbedding()))` raises: AttributeError: 'PlanarEmbedding' object has no attribute '__forbidden'
issue
`PlanarEmbedding.to_undirected()` result in a `Graph` whose edges keep the 'cw' and 'ccw' attributes of one of the half-edges.#TITLE_END#### Current Behavior  `PlanarEmbedding.to_undirected()` result in a `Graph` whose edges keep the 'cw' and 'ccw' attributes of one of the half-edges.  ### Expected Behavior  It is documented that 'overlapping' directed edges result in and unpredictable edge attribute dict being picked for the undirected edge, no surprise there.  Since the 'cw' and 'ccw' edge attributes do not make any sense in the undirected graph, I think `PlanarEmbedding.to_undirected()` should strip these attributes from all edges.  Maybe `DiGraph.to_undirected()` could handle 'overlapping' edges' attributes in a defined way, such as always dropping them (unless they are equal?).  ### Steps to Reproduce  ```python import networkx as nx G = nx.Graph(((0, 1), (1, 2), (2, 3), (3, 0), (0, 2))) is_planar, P = nx.check_planarity(G) is_planar ```     True  ```python P[0][2], P[2][0] ```     ({'cw': 1, 'ccw': 3}, {'ccw': 1, 'cw': 3})  ```python U = P.to_undirected() U[0][2] ```     {'cw': 3, 'ccw': 1}  ### Environment  Python version: 3.10 NetworkX version: 3.3 
issue
fix: make `PlanarEmbedding.copy()` use `add_edges_from()` from parent (closes #7223)#TITLE_END#closes #7223  `PlanarEmbedding` inherits the method `copy()` from `nx.Graph`. However, the current implementation uses the method `add_edges_from()` which was made forbidden by PR #6798.  ### Current Behavior  ```python embedding = nx.PlanarEmbedding({1: {2: {"cw": 2, "ccw": 2}},                                 2: {1: {"cw": 1, "ccw": 1}}}) emb2 = embedding.copy() ``` ``` NotImplementedError: Use `add_half_edge` method to add edges to a PlanarEmbedding. ```
issue
`PlanarEmbedding.copy()` raising `NotImplementedError` after PR #6798#TITLE_END#`PlanarEmbedding` inherits the method `copy()` from `nx.Graph`. However, the current implementation uses the method `add_edges_from()` which was made forbidden by PR #6798.  ### Current Behavior  ```python embedding = nx.PlanarEmbedding({1: {2: {"cw": 2, "ccw": 2}},                                 2: {1: {"cw": 1, "ccw": 1}}}) emb2 = embedding.copy() ``` ``` NotImplementedError: Use `add_half_edge` method to add edges to a PlanarEmbedding. ```  ### Environment  Python version: 3.11 NetworkX version: commit fd3cadc (main)  ### Additional context  PR #6798 was written by me to solve a bug, but the blocking of inherited edge-adding methods was requested by @dschult.  I think this block is quite likely to break code in unforeseen places. The safer approach would be to extend these methods in PlanarEmbedding and display a deprecation warning for a while (I can't work on that at the moment).  The specific problem with `copy()` can be resolved by the PR below.
issue
PlanarEmbedding.remove_edge() now updates removed edge's neighbors#TITLE_END#<!-- Please run black to format your code. See https://networkx.org/documentation/latest/developer/contribute.html for details. --> Removing an edge in a `PlanarEmbedding` requires updating the data dict (`'cw'` and `'ccw'` values) of neighboring edges on both ends. This PR implements this updating.  closes #6796
issue
Modifying the edges of a PlannarEmbedding graph invalidates its structure.#TITLE_END#<!-- If you have a general question about NetworkX, please use the discussions tab to create a new discussion -->  <!--- Provide a general summary of the issue in the Title above -->  If an edge is removed and another one added to a `PlanarEmbedding`, it becomes invalid even if the modifications result in a planar embedding (see notebook below).  ### Current Behavior  An error is produced upon calling `PlanarEmbedding.check_structure()`.  ### Expected Behavior  No error (provided the graph is still a planar embedding).  ### Steps to Reproduce  ```python import networkx as nx  edges = ((0, 1), (1, 2), (2, 3), (3, 0), (0, 2)) pos = ((0, 0), (1, 0), (1, 1), (0, 1))  Gmwe = nx.Graph(((0, 1),                  (1, 2),                  (2, 3),                  (3, 0),                  (0, 2)))  cert, Pmwe = nx.check_planarity(Gmwe) cert ``` Output:     True  ```python type(Pmwe) ``` Output:     networkx.algorithms.planarity.PlanarEmbedding  ```python nx.draw(Pmwe, with_labels=True, pos=pos) ``` ![output_5_0](https://github.com/networkx/networkx/assets/856825/ea8589c7-6d20-46f3-bb12-2d8641f28bdf) ```python list(Pmwe.neighbors_cw_order(0)) ``` Output:     [1, 3, 2] ```python list(Pmwe.neighbors_cw_order(2)) ``` Output:     [1, 0, 3]  Now we remove the edge `(0, 2)` and add `(3, 1)`, inserting each half-edge in the proper position. ```python Pmwe.remove_edges_from(((0, 2), (2, 0))) Pmwe.add_half_edge_ccw(1, 3, 2) Pmwe.add_half_edge_cw(3, 1, 2) ```  ```python nx.draw(Pmwe, with_labels=True, pos=pos) ``` ![output_10_0](https://github.com/networkx/networkx/assets/856825/20adc934-4c37-46bf-a433-c786bf8b3cca)  Why is the modified PlanarEmbedding not structurally sound anymore?  ```python Pmwe.check_structure() ``` Output:      ---------------------------------------------------------------------------      KeyError                                  Traceback (most recent call last)      File ~\programs\miniconda\envs\interarray\lib\site-packages\networkx\algorithms\planarity.py:938, in PlanarEmbedding.check_structure(self)         937 try:     --> 938     sorted_nbrs = set(self.neighbors_cw_order(v))         939 except KeyError as err:           File ~\programs\miniconda\envs\interarray\lib\site-packages\networkx\algorithms\planarity.py:915, in PlanarEmbedding.neighbors_cw_order(self, v)         914 yield current_node     --> 915 current_node = self[v][current_node]["cw"]           File ~\programs\miniconda\envs\interarray\lib\site-packages\networkx\classes\coreviews.py:53, in AtlasView.__getitem__(self, key)          52 def __getitem__(self, key):     ---> 53     return self._atlas[key]           KeyError: 2           The above exception was the direct cause of the following exception:           NetworkXException                         Traceback (most recent call last)      Cell In[12], line 1     ----> 1 Pmwe.check_structure()           File ~\programs\miniconda\envs\interarray\lib\site-packages\networkx\algorithms\planarity.py:941, in PlanarEmbedding.check_structure(self)         939 except KeyError as err:         940     msg = f"Bad embedding. Missing orientation for a neighbor of {v}"     --> 941     raise nx.NetworkXException(msg) from err         943 unsorted_nbrs = set(self[v])         944 if sorted_nbrs != unsorted_nbrs:           NetworkXException: Bad embedding. Missing orientation for a neighbor of 0   The `check_planarity()` function has no problems with it:  ```python cert, Nmwe = nx.check_planarity(Pmwe) cert ``` Output:     True  ```python nx.draw(Nmwe, with_labels=True, pos=pos) ``` ![output_15_0](https://github.com/networkx/networkx/assets/856825/a7bfc515-0bd7-4c47-a158-543af6203f63)   ```python nx.difference(Pmwe, Nmwe).edges ``` Output:     OutEdgeView([])   ### Environment  Python version: 3.10.12 NetworkX version: 3.1  ### Additional context  <!--- Add any other context about the problem here, screenshots, etc. --> 
issue
feat: drop the use of node attribute "first_nbr" in PlanarEmbedding#TITLE_END#The use of a node attribute called `"first_nbr"` makes it impossible to represent a valid PlanarEmbedding with a dict_of_dicts. This complicates the creation of valid and invalid embeddings for testing purposes, particularly if the changes in the PR to solve issue #6798 (which forbids the use of `PlanarEmbedding.add_edge*`) are merged.  The attribute `"first_nbr"` seems to be relevant only to `LRPlanarity.lr_planarity()` and the way the methods `add_half_edge_first()` and `add_half_edge_ccw()` update that attribute are quite unintuitive and undocumented. This means I doubt there is someone out there relying on this attribute  This PR introduces a new method `add_half_edge()`, which covers the functionality of `add_half_edge_cw()`, `add_half_edge_ccw()` and `add_half_edge_first()` while mimicking their behavior regarding the role of `"first_nbr"`. These three methods are still fully functional, but could be deprecated in favor of `add_half_edge()` (although some form of `add_half_edge_first()` will be still necessary for LRPlanarity to work). The attribute `"first_nbr"` is no longer necessary and its functionality is obtained by relying on the keeping of insertion order of dict since Python 3.7.   Tests related to planarity.py were updated to use the new method.
