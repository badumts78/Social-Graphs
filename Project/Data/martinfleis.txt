issue
could_be_isomorphic returns False for an isomorphic graph on 3.2#TITLE_END#<!-- If you have a general question about NetworkX, please use the discussions tab to create a new discussion -->  <!--- Provide a general summary of the issue in the Title above -->  ### Current Behavior  We have noticed a new failure on downstream testing using isomorphic checks when updating to networkx 3.2. We know that the graph we check is isomorphic, yet `nx.could_be_isomorphic` started returning `False`, which I believe is a regression in the latest release.  <!--- Tell us what happens instead of the expected behavior -->  ### Expected Behavior  `nx.could_be_isomorphic` should return `True` for an isomorphic graph  <!--- Tell us what should happen -->  ### Steps to Reproduce  ```py import networkx as nx  left = nx.read_gexf("left.gexf") right = nx.read_gexf("right.gexf") assert nx.is_isomorphic(left, right) nx.could_be_isomorphic(left, right) # should be True but is False ``` <!--- Provide a minimal example that reproduces the bug -->  ### Environment  <!--- Please provide details about your local environment -->  Python version: 3.9 - 3.12 NetworkX version: 3.2  ### Additional context  <!--- Add any other context about the problem here, screenshots, etc. -->  The gefx files:  [Archive.zip](https://github.com/networkx/networkx/files/13061063/Archive.zip)  
issue
Greedy color 'smallest_last' inconsistent across python versions#TITLE_END#There is an inconsistency in the results of `nx.greedy_color(G, strategy='smallest_last')` between Python versions. Python 3.6 yields different labels than Python3.7 (3.8 is the same as 3.7). Both are topologically correct, but a bit different.   ``` G = nx.from_dict_of_dicts(dictionary) greedy = nx.greedy_color(G, strategy='smallest_last')  collections.Counter(greedy.values()) # Counter({0: 71, 1: 52, 2: 39, 3: 15}) - Python 3.8 # Counter({0: 71, 1: 53, 2: 35, 3: 18}) - Python 3.6 ```  The dictionary used within the snippet above is in details:   <details>  ``` G = nx.from_dict_of_dicts({0: {},  1: {11: {'weight': 1.0},   13: {'weight': 1.0},   70: {'weight': 1.0},   71: {'weight': 1.0},   72: {'weight': 1.0},   75: {'weight': 1.0},   168: {'weight': 1.0},   169: {'weight': 1.0}},  2: {53: {'weight': 1.0}, 82: {'weight': 1.0}, 162: {'weight': 1.0}},  3: {4: {'weight': 1.0}},  4: {3: {'weight': 1.0}, 27: {'weight': 1.0}},  5: {6: {'weight': 1.0},   18: {'weight': 1.0},   105: {'weight': 1.0},   106: {'weight': 1.0},   139: {'weight': 1.0}},  6: {5: {'weight': 1.0},   103: {'weight': 1.0},   104: {'weight': 1.0},   105: {'weight': 1.0},   106: {'weight': 1.0}},  7: {8: {'weight': 1.0}},  8: {7: {'weight': 1.0}, 24: {'weight': 1.0}, 148: {'weight': 1.0}},  9: {10: {'weight': 1.0},   28: {'weight': 1.0},   29: {'weight': 1.0},   30: {'weight': 1.0},   156: {'weight': 1.0}},  10: {9: {'weight': 1.0}, 30: {'weight': 1.0}, 31: {'weight': 1.0}},  11: {1: {'weight': 1.0},   66: {'weight': 1.0},   67: {'weight': 1.0},   70: {'weight': 1.0},   74: {'weight': 1.0},   75: {'weight': 1.0},   168: {'weight': 1.0},   169: {'weight': 1.0},   176: {'weight': 1.0}},  12: {13: {'weight': 1.0}, 165: {'weight': 1.0}, 167: {'weight': 1.0}},  13: {1: {'weight': 1.0},   12: {'weight': 1.0},   165: {'weight': 1.0},   168: {'weight': 1.0},   176: {'weight': 1.0}},  14: {15: {'weight': 1.0},   66: {'weight': 1.0},   154: {'weight': 1.0},   163: {'weight': 1.0},   164: {'weight': 1.0},   165: {'weight': 1.0},   176: {'weight': 1.0}},  15: {14: {'weight': 1.0},   55: {'weight': 1.0},   57: {'weight': 1.0},   66: {'weight': 1.0},   164: {'weight': 1.0}},  16: {17: {'weight': 1.0}},  17: {16: {'weight': 1.0}},  18: {5: {'weight': 1.0},   21: {'weight': 1.0},   95: {'weight': 1.0},   97: {'weight': 1.0},   111: {'weight': 1.0},   112: {'weight': 1.0},   113: {'weight': 1.0},   118: {'weight': 1.0},   119: {'weight': 1.0},   120: {'weight': 1.0},   139: {'weight': 1.0},   145: {'weight': 1.0},   146: {'weight': 1.0},   151: {'weight': 1.0}},  19: {},  20: {},  21: {18: {'weight': 1.0}, 110: {'weight': 1.0}, 151: {'weight': 1.0}},  22: {},  23: {},  24: {8: {'weight': 1.0}},  25: {26: {'weight': 1.0},   48: {'weight': 1.0},   49: {'weight': 1.0},   50: {'weight': 1.0},   72: {'weight': 1.0},   73: {'weight': 1.0}},  26: {25: {'weight': 1.0}},  27: {4: {'weight': 1.0}, 38: {'weight': 1.0}, 39: {'weight': 1.0}},  28: {9: {'weight': 1.0}, 29: {'weight': 1.0}},  29: {9: {'weight': 1.0},   28: {'weight': 1.0},   30: {'weight': 1.0},   31: {'weight': 1.0},   32: {'weight': 1.0},   40: {'weight': 1.0},   41: {'weight': 1.0},   42: {'weight': 1.0},   43: {'weight': 1.0},   156: {'weight': 1.0}},  30: {9: {'weight': 1.0},   10: {'weight': 1.0},   29: {'weight': 1.0},   31: {'weight': 1.0},   156: {'weight': 1.0}},  31: {10: {'weight': 1.0},   29: {'weight': 1.0},   30: {'weight': 1.0},   32: {'weight': 1.0},   44: {'weight': 1.0}},  32: {29: {'weight': 1.0},   31: {'weight': 1.0},   33: {'weight': 1.0},   40: {'weight': 1.0},   44: {'weight': 1.0}},  33: {32: {'weight': 1.0}, 34: {'weight': 1.0}},  34: {33: {'weight': 1.0}, 35: {'weight': 1.0}},  35: {34: {'weight': 1.0}, 36: {'weight': 1.0}},  36: {35: {'weight': 1.0}, 37: {'weight': 1.0}, 38: {'weight': 1.0}},  37: {36: {'weight': 1.0}, 38: {'weight': 1.0}},  38: {27: {'weight': 1.0},   36: {'weight': 1.0},   37: {'weight': 1.0},   39: {'weight': 1.0}},  39: {27: {'weight': 1.0}, 38: {'weight': 1.0}},  40: {29: {'weight': 1.0}, 32: {'weight': 1.0}, 41: {'weight': 1.0}},  41: {29: {'weight': 1.0}, 40: {'weight': 1.0}, 42: {'weight': 1.0}},  42: {29: {'weight': 1.0}, 41: {'weight': 1.0}, 43: {'weight': 1.0}},  43: {29: {'weight': 1.0},   42: {'weight': 1.0},   121: {'weight': 1.0},   127: {'weight': 1.0},   128: {'weight': 1.0},   129: {'weight': 1.0},   132: {'weight': 1.0},   141: {'weight': 1.0}},  44: {31: {'weight': 1.0}, 32: {'weight': 1.0}},  45: {},  46: {},  47: {},  48: {25: {'weight': 1.0},   49: {'weight': 1.0},   70: {'weight': 1.0},   72: {'weight': 1.0}},  49: {25: {'weight': 1.0},   48: {'weight': 1.0},   50: {'weight': 1.0},   70: {'weight': 1.0}},  50: {25: {'weight': 1.0},   49: {'weight': 1.0},   70: {'weight': 1.0},   74: {'weight': 1.0}},  51: {52: {'weight': 1.0},   53: {'weight': 1.0},   61: {'weight': 1.0},   62: {'weight': 1.0},   80: {'weight': 1.0}},  52: {51: {'weight': 1.0},   53: {'weight': 1.0},   55: {'weight': 1.0},   60: {'weight': 1.0},   61: {'weight': 1.0},   65: {'weight': 1.0},   82: {'weight': 1.0}},  53: {2: {'weight': 1.0},   51: {'weight': 1.0},   52: {'weight': 1.0},   82: {'weight': 1.0}},  54: {55: {'weight': 1.0},   56: {'weight': 1.0},   58: {'weight': 1.0},   65: {'weight': 1.0}},  55: {15: {'weight': 1.0},   52: {'weight': 1.0},   54: {'weight': 1.0},   56: {'weight': 1.0},   57: {'weight': 1.0},   65: {'weight': 1.0},   82: {'weight': 1.0},   164: {'weight': 1.0}},  56: {54: {'weight': 1.0}, 55: {'weight': 1.0}, 57: {'weight': 1.0}},  57: {15: {'weight': 1.0},   55: {'weight': 1.0},   56: {'weight': 1.0},   66: {'weight': 1.0},   67: {'weight': 1.0},   68: {'weight': 1.0},   69: {'weight': 1.0}},  58: {54: {'weight': 1.0}, 59: {'weight': 1.0}, 65: {'weight': 1.0}},  59: {58: {'weight': 1.0}, 60: {'weight': 1.0}, 65: {'weight': 1.0}},  60: {52: {'weight': 1.0},   59: {'weight': 1.0},   61: {'weight': 1.0},   63: {'weight': 1.0},   65: {'weight': 1.0}},  61: {51: {'weight': 1.0},   52: {'weight': 1.0},   60: {'weight': 1.0},   62: {'weight': 1.0},   63: {'weight': 1.0},   64: {'weight': 1.0}},  62: {51: {'weight': 1.0}, 61: {'weight': 1.0}},  63: {60: {'weight': 1.0}, 61: {'weight': 1.0}, 64: {'weight': 1.0}},  64: {61: {'weight': 1.0}, 63: {'weight': 1.0}},  65: {52: {'weight': 1.0},   54: {'weight': 1.0},   55: {'weight': 1.0},   58: {'weight': 1.0},   59: {'weight': 1.0},   60: {'weight': 1.0}},  66: {11: {'weight': 1.0},   14: {'weight': 1.0},   15: {'weight': 1.0},   57: {'weight': 1.0},   67: {'weight': 1.0},   176: {'weight': 1.0}},  67: {11: {'weight': 1.0},   57: {'weight': 1.0},   66: {'weight': 1.0},   68: {'weight': 1.0},   74: {'weight': 1.0}},  68: {57: {'weight': 1.0}, 67: {'weight': 1.0}, 69: {'weight': 1.0}},  69: {57: {'weight': 1.0}, 68: {'weight': 1.0}},  70: {1: {'weight': 1.0},   11: {'weight': 1.0},   48: {'weight': 1.0},   49: {'weight': 1.0},   50: {'weight': 1.0},   71: {'weight': 1.0},   72: {'weight': 1.0},   74: {'weight': 1.0}},  71: {1: {'weight': 1.0}, 70: {'weight': 1.0}, 72: {'weight': 1.0}},  72: {1: {'weight': 1.0},   25: {'weight': 1.0},   48: {'weight': 1.0},   70: {'weight': 1.0},   71: {'weight': 1.0},   73: {'weight': 1.0}},  73: {25: {'weight': 1.0}, 72: {'weight': 1.0}},  74: {11: {'weight': 1.0},   50: {'weight': 1.0},   67: {'weight': 1.0},   70: {'weight': 1.0}},  75: {1: {'weight': 1.0}, 11: {'weight': 1.0}, 169: {'weight': 1.0}},  76: {77: {'weight': 1.0},   79: {'weight': 1.0},   83: {'weight': 1.0},   108: {'weight': 1.0},   163: {'weight': 1.0}},  77: {76: {'weight': 1.0}, 108: {'weight': 1.0}},  78: {},  79: {76: {'weight': 1.0}, 83: {'weight': 1.0}},  80: {51: {'weight': 1.0}},  81: {82: {'weight': 1.0}, 164: {'weight': 1.0}},  82: {2: {'weight': 1.0},   52: {'weight': 1.0},   53: {'weight': 1.0},   55: {'weight': 1.0},   81: {'weight': 1.0},   162: {'weight': 1.0},   164: {'weight': 1.0}},  83: {76: {'weight': 1.0},   79: {'weight': 1.0},   87: {'weight': 1.0},   108: {'weight': 1.0},   158: {'weight': 1.0}},  84: {88: {'weight': 1.0}, 158: {'weight': 1.0}},  85: {158: {'weight': 1.0}},  86: {87: {'weight': 1.0}, 158: {'weight': 1.0}},  87: {83: {'weight': 1.0},   86: {'weight': 1.0},   107: {'weight': 1.0},   108: {'weight': 1.0},   124: {'weight': 1.0},   158: {'weight': 1.0}},  88: {84: {'weight': 1.0}, 157: {'weight': 1.0}, 158: {'weight': 1.0}},  89: {},  90: {91: {'weight': 1.0}, 92: {'weight': 1.0}, 94: {'weight': 1.0}},  91: {90: {'weight': 1.0},   92: {'weight': 1.0},   93: {'weight': 1.0},   148: {'weight': 1.0}},  92: {90: {'weight': 1.0},   91: {'weight': 1.0},   93: {'weight': 1.0},   94: {'weight': 1.0},   139: {'weight': 1.0}},  93: {91: {'weight': 1.0},   92: {'weight': 1.0},   98: {'weight': 1.0},   99: {'weight': 1.0},   139: {'weight': 1.0}},  94: {90: {'weight': 1.0}, 92: {'weight': 1.0}, 139: {'weight': 1.0}},  95: {18: {'weight': 1.0}, 96: {'weight': 1.0}, 139: {'weight': 1.0}},  96: {95: {'weight': 1.0}},  97: {18: {'weight': 1.0}, 139: {'weight': 1.0}},  98: {93: {'weight': 1.0},   99: {'weight': 1.0},   100: {'weight': 1.0},   101: {'weight': 1.0},   102: {'weight': 1.0},   139: {'weight': 1.0}},  99: {93: {'weight': 1.0}, 98: {'weight': 1.0}},  100: {98: {'weight': 1.0}, 139: {'weight': 1.0}},  101: {98: {'weight': 1.0}, 139: {'weight': 1.0}},  102: {98: {'weight': 1.0},   103: {'weight': 1.0},   107: {'weight': 1.0},   139: {'weight': 1.0}},  103: {6: {'weight': 1.0},   102: {'weight': 1.0},   104: {'weight': 1.0},   106: {'weight': 1.0},   107: {'weight': 1.0},   139: {'weight': 1.0}},  104: {6: {'weight': 1.0},   103: {'weight': 1.0},   105: {'weight': 1.0},   139: {'weight': 1.0}},  105: {5: {'weight': 1.0},   6: {'weight': 1.0},   104: {'weight': 1.0},   139: {'weight': 1.0}},  106: {5: {'weight': 1.0},   6: {'weight': 1.0},   103: {'weight': 1.0},   107: {'weight': 1.0}},  107: {87: {'weight': 1.0},   102: {'weight': 1.0},   103: {'weight': 1.0},   106: {'weight': 1.0},   109: {'weight': 1.0},   124: {'weight': 1.0},   145: {'weight': 1.0}},  108: {76: {'weight': 1.0},   77: {'weight': 1.0},   83: {'weight': 1.0},   87: {'weight': 1.0},   124: {'weight': 1.0}},  109: {107: {'weight': 1.0},   124: {'weight': 1.0},   145: {'weight': 1.0},   146: {'weight': 1.0}},  110: {21: {'weight': 1.0}, 151: {'weight': 1.0}},  111: {18: {'weight': 1.0},   112: {'weight': 1.0},   113: {'weight': 1.0},   118: {'weight': 1.0},   119: {'weight': 1.0}},  112: {18: {'weight': 1.0},   111: {'weight': 1.0},   113: {'weight': 1.0},   115: {'weight': 1.0},   116: {'weight': 1.0},   117: {'weight': 1.0},   152: {'weight': 1.0}},  113: {18: {'weight': 1.0},   111: {'weight': 1.0},   112: {'weight': 1.0},   118: {'weight': 1.0},   121: {'weight': 1.0},   152: {'weight': 1.0},   153: {'weight': 1.0}},  114: {115: {'weight': 1.0},   121: {'weight': 1.0},   127: {'weight': 1.0},   141: {'weight': 1.0},   150: {'weight': 1.0},   152: {'weight': 1.0},   153: {'weight': 1.0}},  115: {112: {'weight': 1.0},   114: {'weight': 1.0},   117: {'weight': 1.0},   126: {'weight': 1.0},   150: {'weight': 1.0},   152: {'weight': 1.0},   172: {'weight': 1.0}},  116: {112: {'weight': 1.0}, 117: {'weight': 1.0}},  117: {112: {'weight': 1.0},   115: {'weight': 1.0},   116: {'weight': 1.0},   122: {'weight': 1.0},   172: {'weight': 1.0}},  118: {18: {'weight': 1.0},   111: {'weight': 1.0},   113: {'weight': 1.0},   119: {'weight': 1.0}},  119: {18: {'weight': 1.0},   111: {'weight': 1.0},   118: {'weight': 1.0},   120: {'weight': 1.0}},  120: {18: {'weight': 1.0}, 119: {'weight': 1.0}},  121: {43: {'weight': 1.0},   113: {'weight': 1.0},   114: {'weight': 1.0},   127: {'weight': 1.0},   128: {'weight': 1.0},   129: {'weight': 1.0},   130: {'weight': 1.0},   142: {'weight': 1.0},   153: {'weight': 1.0}},  122: {117: {'weight': 1.0},   123: {'weight': 1.0},   124: {'weight': 1.0},   171: {'weight': 1.0},   172: {'weight': 1.0}},  123: {122: {'weight': 1.0},   124: {'weight': 1.0},   125: {'weight': 1.0},   171: {'weight': 1.0}},  124: {87: {'weight': 1.0},   107: {'weight': 1.0},   108: {'weight': 1.0},   109: {'weight': 1.0},   122: {'weight': 1.0},   123: {'weight': 1.0},   145: {'weight': 1.0},   146: {'weight': 1.0}},  125: {123: {'weight': 1.0},   171: {'weight': 1.0},   173: {'weight': 1.0},   174: {'weight': 1.0}},  126: {115: {'weight': 1.0},   150: {'weight': 1.0},   170: {'weight': 1.0},   172: {'weight': 1.0},   173: {'weight': 1.0}},  127: {43: {'weight': 1.0},   114: {'weight': 1.0},   121: {'weight': 1.0},   141: {'weight': 1.0}},  128: {43: {'weight': 1.0}, 121: {'weight': 1.0}, 129: {'weight': 1.0}},  129: {43: {'weight': 1.0},   121: {'weight': 1.0},   128: {'weight': 1.0},   130: {'weight': 1.0}},  130: {121: {'weight': 1.0}, 129: {'weight': 1.0}},  131: {132: {'weight': 1.0}},  132: {43: {'weight': 1.0}, 131: {'weight': 1.0}},  133: {143: {'weight': 1.0}},  134: {},  135: {},  136: {},  137: {},  138: {},  139: {5: {'weight': 1.0},   18: {'weight': 1.0},   92: {'weight': 1.0},   93: {'weight': 1.0},   94: {'weight': 1.0},   95: {'weight': 1.0},   97: {'weight': 1.0},   98: {'weight': 1.0},   100: {'weight': 1.0},   101: {'weight': 1.0},   102: {'weight': 1.0},   103: {'weight': 1.0},   104: {'weight': 1.0},   105: {'weight': 1.0}},  140: {},  141: {43: {'weight': 1.0},   114: {'weight': 1.0},   127: {'weight': 1.0},   150: {'weight': 1.0}},  142: {121: {'weight': 1.0}},  143: {133: {'weight': 1.0}},  144: {},  145: {18: {'weight': 1.0},   107: {'weight': 1.0},   109: {'weight': 1.0},   124: {'weight': 1.0},   146: {'weight': 1.0}},  146: {18: {'weight': 1.0},   109: {'weight': 1.0},   124: {'weight': 1.0},   145: {'weight': 1.0}},  147: {},  148: {8: {'weight': 1.0}, 91: {'weight': 1.0}, 149: {'weight': 1.0}},  149: {148: {'weight': 1.0}},  150: {114: {'weight': 1.0},   115: {'weight': 1.0},   126: {'weight': 1.0},   141: {'weight': 1.0}},  151: {18: {'weight': 1.0}, 21: {'weight': 1.0}, 110: {'weight': 1.0}},  152: {112: {'weight': 1.0},   113: {'weight': 1.0},   114: {'weight': 1.0},   115: {'weight': 1.0},   153: {'weight': 1.0}},  153: {113: {'weight': 1.0},   114: {'weight': 1.0},   121: {'weight': 1.0},   152: {'weight': 1.0}},  154: {14: {'weight': 1.0}, 165: {'weight': 1.0}, 166: {'weight': 1.0}},  155: {},  156: {9: {'weight': 1.0}, 29: {'weight': 1.0}, 30: {'weight': 1.0}},  157: {88: {'weight': 1.0}, 158: {'weight': 1.0}},  158: {83: {'weight': 1.0},   84: {'weight': 1.0},   85: {'weight': 1.0},   86: {'weight': 1.0},   87: {'weight': 1.0},   88: {'weight': 1.0},   157: {'weight': 1.0}},  159: {},  160: {161: {'weight': 1.0}},  161: {160: {'weight': 1.0}},  162: {2: {'weight': 1.0}, 82: {'weight': 1.0}},  163: {14: {'weight': 1.0}, 76: {'weight': 1.0}, 164: {'weight': 1.0}},  164: {14: {'weight': 1.0},   15: {'weight': 1.0},   55: {'weight': 1.0},   81: {'weight': 1.0},   82: {'weight': 1.0},   163: {'weight': 1.0}},  165: {12: {'weight': 1.0},   13: {'weight': 1.0},   14: {'weight': 1.0},   154: {'weight': 1.0},   166: {'weight': 1.0},   167: {'weight': 1.0},   176: {'weight': 1.0}},  166: {154: {'weight': 1.0}, 165: {'weight': 1.0}, 167: {'weight': 1.0}},  167: {12: {'weight': 1.0}, 165: {'weight': 1.0}, 166: {'weight': 1.0}},  168: {1: {'weight': 1.0},   11: {'weight': 1.0},   13: {'weight': 1.0},   169: {'weight': 1.0},   176: {'weight': 1.0}},  169: {1: {'weight': 1.0},   11: {'weight': 1.0},   75: {'weight': 1.0},   168: {'weight': 1.0}},  170: {126: {'weight': 1.0}, 172: {'weight': 1.0}, 173: {'weight': 1.0}},  171: {122: {'weight': 1.0},   123: {'weight': 1.0},   125: {'weight': 1.0},   172: {'weight': 1.0},   174: {'weight': 1.0}},  172: {115: {'weight': 1.0},   117: {'weight': 1.0},   122: {'weight': 1.0},   126: {'weight': 1.0},   170: {'weight': 1.0},   171: {'weight': 1.0},   173: {'weight': 1.0},   174: {'weight': 1.0}},  173: {125: {'weight': 1.0},   126: {'weight': 1.0},   170: {'weight': 1.0},   172: {'weight': 1.0},   174: {'weight': 1.0}},  174: {125: {'weight': 1.0},   171: {'weight': 1.0},   172: {'weight': 1.0},   173: {'weight': 1.0}},  175: {},  176: {11: {'weight': 1.0},   13: {'weight': 1.0},   14: {'weight': 1.0},   66: {'weight': 1.0},   165: {'weight': 1.0},   168: {'weight': 1.0}}}) ```  </details>
issue
DOC: geospatial example using lines#TITLE_END#Adding geospatial example illustrating conversion of line-based geometry data (any file format via GeoPandas) to primal and dual graphs (in street network analysis jargon) using momepy and PySAL.  This should replace `plot_lines.py` @ljwolf has in #4366.  cc @NicolasCadieux (xref #4323)
comment
That is the same issue that showed up in our CI today https://github.com/geopandas/contextily/actions/runs/7909639251/job/21591004622 It seems to be cause by some network issue and, in our case, simply re-triggering CI fixed it.   Have you encountered the issue in any other case than that single time linked above?
comment
I've seen this one first time today, so I'm not entirely sure what's causing it. The easiest solution may be changing the source of the baseline that is used. If it is caused by the server that is serving the tiles, different one might be a solution.   Are you aware of any difference between CircleCI and GHA that could cause this?
comment
I'll have a look if we can build some additional robustness to contextily. We do have retries on request but if the request returns invalid data like in this case, we do not try to fetch the tile again. I suppose we should.
comment
I am having a really hard time trying to reproduce the issue. I've seen it once in `contextliy` CI and found it a couple of times in your CI but am unable to reproduce it locally. I will implement more robust retries, ensuring that another attempt is made not only if request fails but also if image read fails (this case) but have no idea how to test if it solves the issue...
comment
That would show up as error 403 in the Traceback. I have a PR in contextily that would automatically retry tile download if this error happens but have no clue if it actually solves the issue. 
comment
I'll try to release a fix today
comment
Talking about lines, there are generally two ways of creating graph object from geometry representing planar (street) network.  A) a **primal** approach, where each intersection is a node and each linestring segment connecting two intersections is an edge. That is the model used for 90% of network analysis in urban science to my knowledge. That is how OSMnx builds its `networkx.MultiDiGraph` and that is one of the options momepy's `gdf_to_nx` can do, because that is what people usually expect.  B) a **dual** approach, where each line is a node and intersection topology is turned into edges. That is in the example @ljwolf wrote. One of the options how this is used for street network analysis is an angular analysis, where your routing is weighted via angles between street segments on intersections. The idea is that for better flow, people prefer fewer turns over a shorter distance. But to actually use it you need to get the angle attribute on the edges.  Both of these can be done using `momepy.gdf_to_nx` as Levi mentioned above. Plus you can rebuild geometry again with `momepy.nx_to_gdf` after your graph analysis.   What I would propose is to add a bit of description to docstring to clarify the use case of Queen contiguity as people may eventually expect it is a primal graph although it is not. Also, if you networkx folks are interested, I can draft another example using momepy to generate both options and go back to GeoDataFrames to have the use cases covered more comprehensively.
comment
I will prepare an example on street networks using momepy (as outlined above). That can handle parallel edges (it is a `MultiGraph`). OSMnx can handle then as well (`MultiDiGraph`). Momepy also supports 3D geometry.  @NicolasCadieux Regarding MultiLineStrings, how do you envisage it should work? The only idea coming to my mind is to explode it before graph creation but it is probably not what you have in mind?  
comment
> I see momepy is built on top of geopandas so we would need to be careful with 3D shapes. Some shapely manipulation will not work. The old nx shape read had this problem so you could test with that to see the error that is given.  What I meant is that GeoDataFrame of LineStringZ geom type (x, y, z coords) gets converted to `nx.MultiGraph` and back without the loss of 3D data and the creation reflects all three dimensions. Since its main aim is to work with street networks, I haven't tried much than that.
comment
@ljwolf I've just made a PR (#4407) effectively replacing your `plot_lines.py` as you suggested above. I have covered both momepy and PySAL options there, so we can drop it from this PR. 
comment
> The issue in the build seems to be with pygeos installation from pypi. I only install from conda, so I'm not quite sure how to get the right C version here. I am OK with removing this example if that complicates the stack...  You can do the same principle using `gdf.sindex.qury_bulk` which will use `rtree` in this case instead of `pygeos`. So staying within geopandas all the time should resolve it.
comment
@NicolasCadieux I am curious, have already you tried generating networkx graph from your river cases using `momepy.gdf_to_nx()`? I am working on the example illustrating momepy and it would be nice to have something else apart from obvious street networks. I have tried [sample data](https://gitlab.com/njacadieux/upstream_downstream_shortests_path_dijkstra/-/blob/master/Sample_Data/SampleData_Results.zip) from the repository linked above, which seems to work with no issues, but I am curious about more complex cases (like 3D geometries).
comment
> I can put the 3D version of the geometries if you like.  That would be superb.  > I think momepy will build a MultiGraph by default?  Yes. Since it was designed for street networks, it is crucial to allow parallel edges. It may not be optimal for your case of super large data but may be good enough for smaller.
comment
@NicolasCadieux confirmed as working without issues. Can I use this dataset within the networkx example? (how should I attribute it?)
comment
Yes, figshare DOI is perfect. Thanks!
comment
I am not going to include any algorithms, I just want to illustrate the conversion of geospatial data to networkx.(Multi)Graph and back.
