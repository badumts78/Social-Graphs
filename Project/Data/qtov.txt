issue
Performance degradation from 1.11 to 2.0#TITLE_END#<!--- Provide a general summary of the issue in the Title above -->  ### Current Behavior I have noticed a pretty big performance degradation between 1.11 and 2.0. Had to upgrade recently and could not use 1.11 anymore. In one of my benchmarking tools, I could see that 2.0 is ~10x slower than 1.11 when trying to do bipartite matching.  ### Expected Behavior Not as much of a slowdown.  ### Steps to Reproduce Made a benchmark script. ```python import json import cProfile import networkx as nx from networkx.readwrite import json_graph  with open('graph_adj.txt', 'r') as fl:     graph = json_graph.adjacency_graph(json.load(fl))  def hopcroft_nx():     for _ in range(20):         matches = {}         for component in nx.connected_components(graph):             subgraph = graph.subgraph(component)             spec_resource_match = nx.bipartite.hopcroft_karp_matching(subgraph)             matches.update(spec_resource_match)         # I do nothing with matches, just simulate my current workflow.  # add second argument to .run if you want to save it and view it in SnakeViz cProfile.run('hopcroft_nx()') ```  With an 11MB 'graph_adj' file. [graph_adj.txt](https://github.com/networkx/networkx/files/14918951/graph_adj.txt)   Now, the values are as follows: For networkx 1.11, this is the cProfile output: ``` 129524 function calls (125524 primitive calls) in 1.085 seconds     Ordered by: standard name     ncalls  tottime  percall  cumtime  percall filename:lineno(function)         1    0.000    0.000    1.085    1.085 <string>:1(<module>)        20    0.001    0.000    0.284    0.014 basic.py:142(sets)      4020    0.001    0.000    0.001    0.000 basic.py:171(<genexpr>)      4020    0.001    0.000    0.001    0.000 basic.py:172(<genexpr>)        20    0.266    0.013    0.281    0.014 basic.py:24(color)      8020    0.008    0.000    0.075    0.000 connected.py:205(_plain_bfs)        40    0.002    0.000    0.078    0.002 connected.py:26(connected_components)        20    0.000    0.000    0.001    0.000 decorator.py:199(fix)        20    0.000    0.000    0.001    0.000 decorator.py:229(fun)        20    0.000    0.000    0.000    0.000 decorators.py:50(_not_implemented_for)      8000    0.004    0.000    0.004    0.000 graph.py:1063(neighbors_iter)      8020    0.005    0.000    0.006    0.000 graph.py:1354(degree_iter)        40    0.000    0.000    0.000    0.000 graph.py:1450(is_multigraph)        60    0.000    0.000    0.000    0.000 graph.py:1454(is_directed)        20    0.470    0.024    0.474    0.024 graph.py:1548(subgraph)        20    0.000    0.000    0.000    0.000 graph.py:1858(nbunch_iter)      8020    0.002    0.000    0.002    0.000 graph.py:1904(bunch_iter)        20    0.000    0.000    0.000    0.000 graph.py:258(__init__)        40    0.000    0.000    0.000    0.000 graph.py:330(__iter__)        20    0.000    0.000    0.000    0.000 graph.py:345(__contains__)     16020    0.016    0.000    0.016    0.000 graph.py:379(__getitem__)        40    0.000    0.000    0.000    0.000 inspect.py:2527(name)       100    0.000    0.000    0.000    0.000 inspect.py:2539(kind)        20    0.000    0.000    0.000    0.000 inspect.py:2619(__init__)        20    0.000    0.000    0.000    0.000 inspect.py:2627(args)        20    0.000    0.000    0.000    0.000 inspect.py:2650(kwargs)        20    0.000    0.000    0.000    0.000 inspect.py:2680(apply_defaults)        80    0.000    0.000    0.000    0.000 inspect.py:2845(parameters)        20    0.000    0.000    0.001    0.000 inspect.py:2889(_bind)        20    0.000    0.000    0.001    0.000 inspect.py:3020(bind)        20    0.000    0.000    0.008    0.000 isolate.py:43(isolates)        20    0.001    0.000    0.007    0.000 isolate.py:77(<listcomp>) 8000/4000    0.072    0.000    0.074    0.000 matching.py:114(depth_first_search)        20    0.000    0.000    0.000    0.000 matching.py:128(<dictcomp>)        20    0.000    0.000    0.000    0.000 matching.py:129(<dictcomp>)        20    0.001    0.000    0.001    0.000 matching.py:143(<dictcomp>)        20    0.001    0.000    0.001    0.000 matching.py:144(<dictcomp>)        20    0.003    0.000    0.519    0.026 matching.py:55(hopcroft_karp_matching)        40    0.144    0.004    0.156    0.004 matching.py:97(breadth_first_search)         1    0.013    0.013    1.085    1.085 test.py:43(hopcroft_nx)         1    0.000    0.000    1.085    1.085 {built-in method builtins.exec}      8080    0.001    0.000    0.001    0.000 {built-in method builtins.iter}      8020    0.001    0.000    0.001    0.000 {built-in method builtins.len}        80    0.000    0.000    0.000    0.000 {built-in method builtins.next}        20    0.000    0.000    0.000    0.000 {built-in method fromkeys}      8000    0.001    0.000    0.001    0.000 {method 'add' of 'set' objects}      4020    0.000    0.000    0.000    0.000 {method 'append' of 'collections.deque' objects}      8020    0.001    0.000    0.001    0.000 {method 'append' of 'list' objects}         1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}      8100    0.001    0.000    0.001    0.000 {method 'items' of 'dict' objects}        60    0.000    0.000    0.000    0.000 {method 'items' of 'mappingproxy' objects}      8000    0.001    0.000    0.001    0.000 {method 'pop' of 'list' objects}      4020    0.001    0.000    0.001    0.000 {method 'popleft' of 'collections.deque' objects}        60    0.000    0.000    0.000    0.000 {method 'update' of 'dict' objects}      8020    0.064    0.000    0.064    0.000 {method 'update' of 'set' objects}        20    0.000    0.000    0.000    0.000 {method 'values' of 'mappingproxy' objects} ```  And for anything over 2.0 it's: ``` 24523484 function calls (24519384 primitive calls) in 5.618 seconds     Ordered by: standard name     ncalls  tottime  percall  cumtime  percall filename:lineno(function)         1    0.000    0.000    5.618    5.618 <string>:1(<module>)      8000    0.004    0.000    0.012    0.000 _collections_abc.py:664(__contains__)        20    0.000    0.000    4.379    0.219 basic.py:142(sets)        20    0.001    0.000    0.001    0.000 basic.py:205(<setcomp>)        20    0.000    0.000    0.000    0.000 basic.py:206(<setcomp>)        20    0.296    0.015    2.926    0.146 basic.py:24(color)        20    0.002    0.000    1.450    0.073 connected.py:156(is_connected)     16040    0.016    0.000    1.500    0.000 connected.py:234(_plain_bfs)        40    0.002    0.000    0.062    0.002 connected.py:26(connected_components)     32040    0.007    0.000    0.007    0.000 coreviews.py:284(__init__)      8060    0.004    0.000    1.326    0.000 coreviews.py:288(__len__)   1628060    0.361    0.000    1.199    0.000 coreviews.py:289(<genexpr>)     24060    0.008    0.000    0.008    0.000 coreviews.py:291(__iter__)   4434080    1.017    0.000    3.414    0.000 coreviews.py:292(<genexpr>)      8000    0.005    0.000    0.008    0.000 coreviews.py:294(__getitem__)        20    0.000    0.000    0.000    0.000 coreviews.py:312(__init__)        20    0.000    0.000    0.000    0.000 coreviews.py:320(__iter__)      8020    0.003    0.000    0.005    0.000 coreviews.py:321(<genexpr>)     32020    0.033    0.000    0.045    0.000 coreviews.py:323(__getitem__)   6006000    2.402    0.000    3.233    0.000 coreviews.py:325(new_node_ok)     32080    0.004    0.000    0.004    0.000 coreviews.py:45(__init__)        20    0.000    0.000    0.004    0.000 coreviews.py:48(__len__)     24000    0.005    0.000    0.014    0.000 coreviews.py:51(__iter__)     24020    0.015    0.000    0.043    0.000 coreviews.py:81(__getitem__)        40    0.000    0.000    0.002    0.000 decorator.py:199(fix)        40    0.000    0.000    1.453    0.036 decorator.py:229(fun)        40    0.000    0.000    1.450    0.036 decorators.py:52(_not_implemented_for)   6006000    0.275    0.000    0.275    0.000 filters.py:24(no_filter)        20    0.001    0.000    0.002    0.000 filters.py:55(__init__)   6070040    0.565    0.000    0.565    0.000 filters.py:58(__call__)      8000    0.004    0.000    0.020    0.000 graph.py:1086(neighbors)        20    0.000    0.000    0.000    0.000 graph.py:1254(degree)        80    0.000    0.000    0.000    0.000 graph.py:1315(is_multigraph)       120    0.000    0.000    0.000    0.000 graph.py:1319(is_directed)        20    0.000    0.000    0.002    0.000 graph.py:1533(subgraph)        20    0.000    0.000    0.000    0.000 graph.py:1712(nbunch_iter)      8020    0.001    0.000    0.001    0.000 graph.py:1757(bunch_iter)      8060    0.003    0.000    0.005    0.000 graph.py:316(adj)        80    0.000    0.000    0.000    0.000 graph.py:365(__iter__)        20    0.000    0.000    0.000    0.000 graph.py:383(__contains__)        40    0.000    0.000    0.007    0.000 graph.py:397(__len__)      8020    0.004    0.000    0.026    0.000 graph.py:414(__getitem__)        20    0.000    0.000    0.000    0.000 graphviews.py:68(__init__)        80    0.000    0.000    0.000    0.000 inspect.py:2527(name)       200    0.000    0.000    0.000    0.000 inspect.py:2539(kind)        40    0.000    0.000    0.000    0.000 inspect.py:2619(__init__)        40    0.000    0.000    0.000    0.000 inspect.py:2627(args)        40    0.000    0.000    0.000    0.000 inspect.py:2650(kwargs)        40    0.000    0.000    0.000    0.000 inspect.py:2680(apply_defaults)       160    0.000    0.000    0.000    0.000 inspect.py:2845(parameters)        40    0.001    0.000    0.001    0.000 inspect.py:2889(_bind)        40    0.000    0.000    0.001    0.000 inspect.py:3020(bind)        20    0.000    0.000    0.000    0.000 isolate.py:52(isolates)        20    0.002    0.000    1.354    0.068 isolate.py:94(<genexpr>)        40    0.140    0.004    0.763    0.019 matching.py:116(breadth_first_search) 8000/4000    0.086    0.000    0.406    0.000 matching.py:133(depth_first_search)        20    0.000    0.000    0.000    0.000 matching.py:147(<dictcomp>)        20    0.000    0.000    0.000    0.000 matching.py:148(<dictcomp>)        20    0.001    0.000    0.001    0.000 matching.py:162(<dictcomp>)        20    0.000    0.000    0.000    0.000 matching.py:163(<dictcomp>)        20    0.003    0.000    5.552    0.278 matching.py:56(hopcroft_karp_matching)        20    0.000    0.000    0.000    0.000 misc.py:198(is_iterator)        20    0.000    0.000    0.000    0.000 misc.py:207(arbitrary_element)        20    0.000    0.000    0.000    0.000 reportviews.py:333(__init__)        20    0.000    0.000    0.000    0.000 reportviews.py:341(__call__)      8020    0.009    0.000    1.352    0.000 reportviews.py:440(__iter__)         1    0.001    0.001    5.618    5.618 test.py:43(hopcroft_nx)         1    0.000    0.000    5.618    5.618 {built-in method builtins.exec}       100    0.000    0.000    0.000    0.000 {built-in method builtins.hasattr} 32200/32160    0.007    0.000    0.014    0.000 {built-in method builtins.iter} 8140/8080    0.003    0.000    1.330    0.000 {built-in method builtins.len}       180    0.000    0.000    0.000    0.000 {built-in method builtins.next}      8060    0.123    0.000    1.322    0.000 {built-in method builtins.sum}        20    0.000    0.000    1.354    0.068 {built-in method fromkeys}     16000    0.003    0.000    0.003    0.000 {method 'add' of 'set' objects}      4020    0.000    0.000    0.000    0.000 {method 'append' of 'collections.deque' objects}      8060    0.001    0.000    0.001    0.000 {method 'append' of 'list' objects}         1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}      8000    0.002    0.000    0.002    0.000 {method 'format' of 'str' objects}       120    0.000    0.000    0.000    0.000 {method 'items' of 'dict' objects}       120    0.000    0.000    0.000    0.000 {method 'items' of 'mappingproxy' objects}      8000    0.001    0.000    0.001    0.000 {method 'pop' of 'list' objects}      4020    0.000    0.000    0.000    0.000 {method 'popleft' of 'collections.deque' objects}        40    0.000    0.000    0.000    0.000 {method 'update' of 'dict' objects}     16020    0.194    0.000    1.456    0.000 {method 'update' of 'set' objects}        40    0.000    0.000    0.000    0.000 {method 'values' of 'mappingproxy' objects} ```   ### Environment WSL2 venv  Python version: 3.10 (for Networkx >= 2.6), 3.8 (for Networkx <= 2.4) NetworkX version: 1.11 -> 3.2.1  ### Additional context While I know that networkx is not made for speed, I'm just bringing to attention if this degradation in performance is actually intended. I also visually see in SnakeViz when putting this cProfile output that there's more changes like "checking for connected graphs", etc.  Unfortunately also trying to convert this graph to scipy using `to_scipy_sparse_array` also takes almost the same as the matching, hence making the whole conversion useless most of the times. 
