issue
Fix `nx_pydot.graphviz_layout` for nodes with quoted/escaped chars#TITLE_END#Fixes https://github.com/networkx/networkx/issues/7581 and https://github.com/pydot/pydot/issues/396  Explanation of the problem:  1. In new versions of Pydot, node names are stored unchanged. They are NOT quoted/escaped on creation. 2. They are quoted/escaped if necessary when output to a `.dot` file. This is to follow the DOT grammar. Example: `Node("a\nb")` must be saved in the .dot file as `"a\nb"` (quoted and escaped), not `a(actual new line)b`. 3. Combining 1. and 2. means that saving a node in `.dot` and reading it back may result in a node with a different name. Example: `Node("a\nb")` -> saved to `.dot` as `"a\nb"` -> read back into a `Node("a\\nb")`. 4. `nx.drawing.nx_pydot.graphviz_layout` doesn't expect this.  This PR fixes the issue by explicitly using `pydot.quote_id_if_necessary` in the place which didn't expect the unquoted value to appear.  An additional test was added. It is easier than modifying the existing old test which is quite long.
issue
`nx.drawing.nx_pydot.graphviz_layout` crashes on a node with `"\n"` in the name (on new pydot versions)#TITLE_END#### Current Behavior  <!--- Tell us what happens instead of the expected behavior --> If a graph contains a node with a name containing `"\n"`, then calling `nx.drawing.nx_pydot.graphviz_layout()` on it crashes.  ``` Traceback (most recent call last):   File ".../script.py", line 29, in <module>     pos = nx.drawing.nx_pydot.graphviz_layout(G, prog="dot")           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^   File ".../.venv/lib/python3.12/site-packages/networkx/drawing/nx_pydot.py", line 322, in graphviz_layout     return pydot_layout(G=G, prog=prog, root=root)            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^   File ".../.venv/lib/python3.12/site-packages/networkx/drawing/nx_pydot.py", line 406, in pydot_layout     node = node[0]            ~~~~^^^ IndexError: list index out of range ```  ### Expected Behavior `nx.drawing.nx_pydot.graphviz_layout()` call on a graph with nodes that have `"\n"` in their names returns without any error.  ### Steps to Reproduce (see linked issue below for full crashing code)  ### Environment NetworkX version: latest Pydot version `3.0.1`  ### Additional context  The original issue was raised in pydot https://github.com/pydot/pydot/issues/396 An example script that crashes is in its description. The true reason is on `pydot`'s side: there was a fix so that nodes are escaped and quoted only on their final output.  In short, if you created a node with name `A\ntest`, earlier `node.get_name()` returned `"A\\ntest"` (quoted and escaped), and now it returns `A\ntest` (raw input) because that's what's expected. You want the original name.  Now, somehow the function `nx.drawing.nx_pydot.graphviz_layout` was dependent on the wrong behavior, so the fix broke it:  https://github.com/networkx/networkx/blob/main/networkx/drawing/nx_pydot.py#L335-L421  I wanted to fix that immediately. But I got stuck on the code â€“ it's very complex. To quote the comment from the issue:  > From what I can see, the `nx.drawing.nx_pydot.graphviz_layout` call: > 1. Creates a Pydot graph (1) from a NetworkX graph (2) > 2. Converts (1) to `.dot` (3) > 3. Parses the (3) back to a new Pydot graph (4) > 4. Iterates over (2)'s nodes, creates new Pydot nodes (5) from them and then uses (5)'s names to retrieve a node from the (4) graph. The error happens at that point, so what happens after is irrelevant.  It's pretty convoluted. I'll admit I still don't understand what is going on  here :smile:  I was wondering if we could somehow simplify whatever `nx.drawing.nx_pydot.graphviz_layout` is doing, while at the same time fixing the problem.  Full additional context in: https://github.com/pydot/pydot/issues/396
comment
Yes, it will be released soon. Thanks @Peiffap for being the first person to report this in pydot! Please report pydot issues in pydot, because nobody was aware of this one, and it has been hanging for a year ðŸ˜„ 
comment
Nice, thanks! 
comment
@jarrodmillman  @MridulS  @rossbar A new pydot version has been released which should fix the breaking issues!  I'm not sure what's the current state of pydot in networkx, but I'm just letting you know that if you'd want to bring it back, you could try ðŸ˜„ 
