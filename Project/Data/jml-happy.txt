issue
Fixes read/write_gml with nan/inf attributes#TITLE_END#Fixes issue #4484  Write floats inf as +INF and nan as _NAN for gml files.  Read +INF, -INF, _NAN as floats.
issue
Problem with read/write_gml with nan/inf attributes#TITLE_END#If a node or edge attribute is nan or inf then nx.write_gml() writes these as NAN and INF respectively, but they are unquoted. As a result reading the gml file back in raises an exception since they match the key regex in tokenize().  Is this intentional?   Writing a de/stringizer doesn't seem to work (though honestly I've never tried to write a de/stringizer before so maybe I'm doing it wrong).  A workaround is to iterate over the attributes and change to a string/float before/after writing/reading.   A hacky fix is to put special handling in gml.py.  It would be nice if NetworkX had some way to handle this.  **To reproduce:** Python 3.7 NetworkX 2.5 numpy 1.19.4 conda environment ``` >>> import networkx as nx >>> import numpy as np >>>  >>> nx.__version__ '2.5' >>> np.__version__ '1.19.4' >>>  >>> G_nde = nx.path_graph(3) >>> for n in G_nde.nodes: ...     G_nde.nodes[n]["nandata"] = np.nan ...     G_nde.nodes[n]["infdata"] = np.inf ...  >>> G_edg = nx.path_graph(3) >>> for u, v in G_edg.edges: ...     G_edg[u][v]["nandata"] = np.nan ...     G_edg[u][v]["infdata"] = np.inf ...  >>> G_nde.nodes(data=True) NodeDataView({0: {'nandata': nan, 'infdata': inf}, 1: {'nandata': nan, 'infdata': inf}, 2: {'nandata': nan, 'infdata': inf}}) >>> G_edg.edges(data=True) EdgeDataView([(0, 1, {'nandata': nan, 'infdata': inf}), (1, 2, {'nandata': nan, 'infdata': inf})]) >>>  >>> nx.write_gml(G_nde, "test_naninf_nodes.gml") >>> nx.write_gml(G_edg, "test_naninf_edges.gml") >>>  >>>  >>> H_nde = nx.read_gml("test_naninf_nodes.gml") Traceback (most recent call last):   File "<stdin>", line 1, in <module>   File "<decorator-gen-684>", line 2, in read_gml   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/utils/decorators.py", line 239, in _open_file     result = func_to_be_decorated(*new_args, **kwargs)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 181, in read_gml     G = parse_gml_lines(filter_lines(path), label, destringizer)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 411, in parse_gml_lines     graph = parse_graph()   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 400, in parse_graph     curr_token, dct = parse_kv(next(tokens))   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 355, in parse_kv     curr_token, value = parse_dict(curr_token)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 394, in parse_dict     curr_token, dct = parse_kv(curr_token)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 355, in parse_kv     curr_token, value = parse_dict(curr_token)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 394, in parse_dict     curr_token, dct = parse_kv(curr_token)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 375, in parse_kv     unexpected(curr_token, "an int, float, string or '['")   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 330, in unexpected     raise NetworkXError(f"expected {expected}, found {value} at ({lineno}, {pos})") networkx.exception.NetworkXError: expected an int, float, string or '[', found 'NAN' at (5, 13) >>>  >>>  >>>  >>> H_edg = nx.read_gml("test_naninf_edges.gml") Traceback (most recent call last):   File "<stdin>", line 1, in <module>   File "<decorator-gen-684>", line 2, in read_gml   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/utils/decorators.py", line 239, in _open_file     result = func_to_be_decorated(*new_args, **kwargs)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 181, in read_gml     G = parse_gml_lines(filter_lines(path), label, destringizer)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 411, in parse_gml_lines     graph = parse_graph()   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 400, in parse_graph     curr_token, dct = parse_kv(next(tokens))   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 355, in parse_kv     curr_token, value = parse_dict(curr_token)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 394, in parse_dict     curr_token, dct = parse_kv(curr_token)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 355, in parse_kv     curr_token, value = parse_dict(curr_token)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 394, in parse_dict     curr_token, dct = parse_kv(curr_token)   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 375, in parse_kv     unexpected(curr_token, "an int, float, string or '['")   File "/home/USERNAME/anaconda3/envs/CONDA_ENV_NAME/lib/python3.7/site-packages/networkx/readwrite/gml.py", line 330, in unexpected     raise NetworkXError(f"expected {expected}, found {value} at ({lineno}, {pos})") networkx.exception.NetworkXError: expected an int, float, string or '[', found 'NAN' at (17, 13) >>>  ``` **Workaround for nodes** ``` >>> I_nde = G_nde.copy() >>>  >>> I_nde.nodes(data=True) NodeDataView({0: {'nandata': nan, 'infdata': inf}, 1: {'nandata': nan, 'infdata': inf}, 2: {'nandata': nan, 'infdata': inf}}) >>>  >>> for n, d in I_nde.nodes(data=True): ...     for k, v in d.items(): ...             if isinstance(v, float): ...                     if np.isnan(v): ...                             I_nde.nodes[n][k] = "NAN" ...                     if np.isinf(v): ...                             I_nde.nodes[n][k] = "INF" ...  >>>  >>> nx.write_gml(I_nde, "test_naninf_nodes_string.gml") >>>  >>> J_nde = nx.read_gml("test_naninf_nodes_string.gml") >>> J_nde.nodes(data=True) NodeDataView({'0': {'nandata': 'NAN', 'infdata': 'INF'}, '1': {'nandata': 'NAN', 'infdata': 'INF'}, '2': {'nandata': 'NAN', 'infdata': 'INF'}}) >>>  >>> for n, d in J_nde.nodes(data=True): ...     for k, v in d.items(): ...             if isinstance(v, str): ...                     if v == "NAN": ...                             J_nde.nodes[n][k] = np.nan ...                     if v == "INF": ...                             J_nde.nodes[n][k] = np.inf ...  >>>  >>> J_nde.nodes(data=True) NodeDataView({'0': {'nandata': nan, 'infdata': inf}, '1': {'nandata': nan, 'infdata': inf}, '2': {'nandata': nan, 'infdata': inf}}) >>>  ```  **Hacky fix:** Add ``` if value in {"NAN", "INF", "-INF"}:      value = float(value)      i = 1 ``` after line 313 of gml.py
comment
  Not sure exactly what you are trying to do but...  >  Documentation mentions somewhere, that "id" and "label" are maintained by networkx and in fact, a user-defined "label" entry will be overwritten from write_gml.  If the documentation says that it is wrong... for 2.4+ at least.  You can label nodes with almost any object, so long as it isn't something that the labeler tries to 'unpack' (like a list or array, but tuples work).  You can even label a node with a graph!  And you can write to a gml and read back with custom de/stringizers.   ### A simple example ``` >>> import networkx as nx >>> import numpy as np >>> nx.__version__ '2.4' >>>  >>> G = nx.path_graph(5) >>> an_array = np.arange(4) >>>  >>> simple_relabel_dict = {0: "astring", 1: 37, 2: np.pi} >>>  >>> H_1 = nx.relabel_nodes(G, simple_relabel_dict) >>>  >>> H_1.nodes NodeView(('astring', 37, 3.141592653589793, 3, 4)) >>>  >>>  >>> nx.write_gml(H_1, "H_1.simple.relabel.gml") >>> ```  ### Contents of "H_1.simple.relabel.gml" Note the numbers get quoted.  ``` graph [   node [     id 0     label "astring"   ]   node [     id 1     label "37"   ]   node [     id 2     label "3.141592653589793"   ]   node [     id 3     label "3"   ]   node [     id 4     label "4"   ]   edge [     source 0     target 1   ]   edge [     source 1     target 2   ]   edge [     source 2     target 3   ]   edge [     source 3     target 4   ] ] ```  ### The quoted numbers do get read back in as strings...  ``` >>> H_1_in = nx.read_gml("H_1.simple.relabel.gml") >>>  >>> H_1_in.nodes NodeView(('astring', '37', '3.141592653589793', '3', '4')) >>>  ```  ### But a custom destringizer can handle that.  ``` >>> import ast >>> def simple_destringize(val): ...     return ast.literal_eval(val) ...  >>> H_1_in_b = nx.read_gml("H_1.simple.relabel.gml", destringizer=simple_destringize) >>>  >>> H_1_in_b.nodes NodeView(('astring', 37, 3.141592653589793, 3, 4)) >>>  ```  ### More complex objects (even graphs) can be used to label nodes, get written, and read back in.  ``` >>> Gsub = nx.cycle_graph(3) >>>  >>> fancy_relabel_dict = {0: "astring", 1: 37, 2: np.pi, 3: (1, 3, 6), 4: Gsub} >>> H_2 = nx.relabel_nodes(G, fancy_relabel_dict) >>>  >>> H_2.nodes NodeView(('astring', 37, 3.141592653589793, (1, 3, 6), <networkx.classes.graph.Graph object at 0x7f5ca506f5d0>)) >>>  >>>  >>> def custom_stringize(val): ...     if isinstance(val, nx.classes.graph.Graph): ...             return "\n".join(nx.generate_gml(val)) ...     else: ...             return str(val) ...  >>>  >>> nx.write_gml(H_2, "H_2.fancy_relabel.gml", stringizer=custom_stringize) >>>  ```  ### Contents of "H_2.fancy_relabel.gml"  Note the &#10; values are the HTML entities for a new line. ``` graph [   node [     id 0     label "astring"   ]   node [     id 1     label "37"   ]   node [     id 2     label "3.141592653589793"   ]   node [     id 3     label "(1, 3, 6)"   ]   node [     id 4     label "graph [&#10;  node [&#10;    id 0&#10;    label &#34;0&#34;&#10;  ]&#10;  node [&#10;    id 1&#10;    label &#34;1&#34;&#10;  ]&#10;  node [&#10;    id 2&#10;    label &#34;2&#34;&#10;  ]&#10;  edge [&#10;    source 0&#10;    target 1&#10;  ]&#10;  edge [&#10;    source 0&#10;    target 2&#10;  ]&#10;  edge [&#10;    source 1&#10;    target 2&#10;  ]&#10;]"   ]   edge [     source 0     target 1   ]   edge [     source 1     target 2   ]   edge [     source 2     target 3   ]   edge [     source 3     target 4   ] ] ```  ### Reading it back in ``` >>> Gsub = nx.cycle_graph(3) >>>  >>> fancy_relabel_dict = {0: "astring", 1: 37, 2: np.pi, 3: (1, 3, 6), 4: Gsub} >>> H_2 = nx.relabel_nodes(G, fancy_relabel_dict) >>>  >>> H_2.nodes NodeView(('astring', 37, 3.141592653589793, (1, 3, 6), <networkx.classes.graph.Graph object at 0x7f5d2929de10>)) >>>  >>>  >>> def custom_stringize(val): ...     if isinstance(val, nx.classes.graph.Graph): ...             return "\n".join(nx.generate_gml(val)) ...     else: ...             return str(val) ...  >>>  >>> nx.write_gml(H_2, "H_2.fancy_relabel.gml", stringizer=custom_stringize) >>>  >>>  >>>  >>> def fancy_destringize(val): ...     if val[:7] == "graph [": ...             return nx.parse_gml(val) ...     else: ...             return ast.literal_eval(val) ...  >>>  >>> H_2_in = nx.read_gml("H_2.fancy_relabel.gml", destringizer=fancy_destringize) >>>  >>> H_2_in.nodes NodeView(('astring', 37, 3.141592653589793, (1, 3, 6), <networkx.classes.graph.Graph object at 0x7f5ca6d88610>)) >>> ``` 
